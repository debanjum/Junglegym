<html>
     </head>            

    <script type="text/javascript" src="http://172.16.5.62:7000/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="./libraries/RGraph.line.js" ></script>
	<script type="text/javascript" src="./libraries/RGraph.common.core.js" ></script>
       
	<canvas id="cvs" width="1000" height="450">[No canvas support]</canvas>

	<script>
	    d1  = []; //Graph Data Array
	    l   = 0;  // The letter 'L' - NOT a one
	    var socket = io.connect('http://172.16.5.62:7000');
	    // Pre-pad the arrays with null values
	    for (var i=0; i<1000; ++i) 
	    {  	d1.push(null);  }

	    function getGraph(id, d1)
	    {	
	        // After creating the chart, store it on the global window object
	        if (!window.__rgraph_line__) {
	            window.__rgraph_line__ = new RGraph.Line(id, d1);
	            window.__rgraph_line__.Set('chart.background.barcolor1', 'white');
	            window.__rgraph_line__.Set('chart.background.barcolor2', 'white');	           	           
	            window.__rgraph_line__.Set('chart.title.xaxis', 'Time');
	            window.__rgraph_line__.Set('chart.title.yaxis', 'Voltage');
	            window.__rgraph_line__.Set('chart.title.vpos', 0.5);
	            window.__rgraph_line__.Set('chart.title', 'Spectral Profile');
	            window.__rgraph_line__.Set('chart.title.yaxis.pos', 0.5);
	            window.__rgraph_line__.Set('chart.title.xaxis.pos', 0.5);
	            window.__rgraph_line__.Set('chart.colors', ['black']);
	            window.__rgraph_line__.Set('chart.linewidth',1.5);	            
	            window.__rgraph_line__.Set('chart.yaxispos', 'right');
	            window.__rgraph_line__.Set('chart.ymax', 3.3);
	            window.__rgraph_line__.Set('chart.ymin', 0);
				window.__rgraph_line__.Set('chart.yticks', 1);
	            window.__rgraph_line__.Set('chart.xticks', 5);
				window.__rgraph_line__.Set('units.post', 'V')	            
	        }
	        return window.__rgraph_line__;
	    }
	
	    function drawGraph ()
	    {
            // "cache" this in a local variable
            var _RG = RGraph;	

	        _RG.Clear(document.getElementById("cvs"));
        
	        var graph = getGraph('cvs', d1);
	        graph.Draw();
			    	        
	        socket.on ('connect', function () //Connects to Node Data Server
	             {
	                 socket.on ('d', function (msg) 
	                 {	                     
	                     var VALUE = parseFloat(msg);	// Convert value to integer
						
	                     d1.push(VALUE);				// Push to Graph Data Array

	                     var SPAN  = document.getElementById('sensor_value');
	                       
	                     var text = document.createTextNode(VALUE);
						 
						 if(SPAN.childNodes.length == 0) {	SPAN.appendChild(text) }
						 else {	SPAN.firstChild.nodeValue = VALUE; }
						 
						 if (d1.length > 10) { d1 = _RG.array_shift(d1);  }
					});
				 });
        	       
	        if (document.all && _RG.isIE8()) 
			{  alert('[MSIE] Sorry, Internet Explorer 8 is not fast enough to support animated charts'); } 
			else 
			{  
				window.__rgraph_line__.original_data[0] = d1;				
        	    setTimeout(drawGraph, 10);	//Delay between Graph Updates
        	}
	    }
	    drawGraph();
	    
	    socket.on( 'sff', function() 
	    {
			
		} );

	    function initspec(start,stop) 
	    {
			 socket.emit('initspec', start, stop );
		}
		
		function scanspec()
		{
			socket.emit('scanspec');
		}
		
		function resetspec()
		{
			socket.emit('resetspec');
		}
		
	</script>
      </head>
      
      <body>
           <div role="main">
               Analog Out: <span id="sensor_value"></span>
           </div>

          <div style="float: center">
     	     <canvas id="cvs" width="1000" height="200">[No canvas support]</canvas><br />
     	     <span style="margin-left: 25px">
     	       Number of updates: <span id="num_updates">0</span>
     	     </span>
     	  </div>
     	  
		 <form name="input" action="" method="post">
			Start Wavelength: <input type="text" name="startwave" id="startw" ><br />
			Stop Wavelength: <input type="text" name="stopwave" id="stopw" ><br />
			<input type="button" value="reset" onClick=resetspec()>
			<input type="button" value="intialise" onClick=initspec(startw.value,stopw.value)>
			<input type="button" value="scan" onClick=scanspec()>
		 </form>
      </body>

</html>
